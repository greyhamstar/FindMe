<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FindMe! — Promoter Dashboard</title>
  <link rel="stylesheet" href="assets/style.css" />
</head>
<body>
  <div class="container">
    <div id="nav"></div>
    <div class="card">
      <h1>Available Campaigns</h1>
      <p class="kicker">Filtered by your region</p>
      <div id="list" class="grid"></div>
    </div>
    <footer>FindMe! MVP • LocalStorage demo</footer>
  </div>

  <script type="module">
    import { Auth, ensureNav } from './js/auth.js';
    import { Campaigns } from './js/campaigns.js';
    import { UI } from './js/ui.js';
    import { qs } from './js/utils.js';
    ensureNav();
    const me = Auth.requireAuth();
    if (me.role !== 'promoter') location.href = 'company_dashboard.html';

    const render = () => {
      const list = Campaigns.forRegion(me.region);
      const root = document.querySelector('#list');
      if (!list.length) { root.innerHTML = UI.empty('No campaigns in your region yet.'); return; }
      root.innerHTML = list.map(c => UI.campaignCard(c, {showRegion:false, showApply:true, applied: Campaigns.hasApplied(c.id, me.id)})).join('');
      root.querySelectorAll('[data-apply]').forEach(btn => {
        btn.addEventListener('click', (e)=>{
          const id = e.currentTarget.getAttribute('data-apply');
          Campaigns.apply({campaignId:id, promoterId: me.id});
          e.currentTarget.disabled = true;
          UI.toast('Application sent');
        });
      });
    };
    render();
  </script>
</body>
</html>
