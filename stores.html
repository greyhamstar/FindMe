<!doctype html><html lang='en'><head><meta charset='utf-8'><meta name='viewport' content='width=device-width,initial-scale=1'><title>FindMe — Stores</title><link rel='stylesheet' href='css/style.css'></head><body>
<header class="hdr">
  <div class="brand">
    <img class="brand-logo" src="assets/logo.png" alt="FindMe logo">
    <div class="brand-text">
      <span class="brand-name">FindMe</span>
      <span class="brand-tag">Campaign Staffing</span>
    </div>
  </div>
  <div class="hdr-right">
    <nav id="mainNav" class="nav">
      <a class="chip" href="index.html">Home</a>
      <a class="chip" href="dashboard.html">Dashboard</a>
      <a class="chip" href="update_profile.html">Profile</a>
      <a class="chip" id="navPromoters" href="promoters.html">Promoters</a>
      <a class="chip" id="navStores" href="stores.html">Stores</a>
      <a class="chip" id="navPost" href="post_campaign.html">Post Campaign</a>
      <a class="chip" id="navActive" href="active_campaigns.html">Active Campaigns</a>
      <a class="chip" id="navSuper" href="super.html">Super</a>
      <a class="chip" href="signup.html">Create account</a>
      <button id="logoutBtn" class="btn-ghost">Logout</button>
    </nav>
    <button class="btn-ghost icon" id="navToggle" aria-label="Menu">☰</button>
  </div>
</header>
<script type="module">
import { onAuth, getUserDoc, signOut } from './js/offline.js';
document.getElementById('navToggle').addEventListener('click', ()=>document.querySelector('.nav').classList.toggle('open'));
const lg = document.getElementById('logoutBtn'); if(lg) lg.addEventListener('click', ()=>signOut().then(()=>location.href='login.html'));
onAuth(async (u)=>{ 
  const me = u ? await getUserDoc(u.id||u) : null;
  const isCompany = me && me.role==='company'; const isPromoter = me && me.role==='promoter'; const isSuper = me && me.role==='super';
  const show = (id, ok)=>{ const el=document.getElementById(id); if(el) el.style.display = ok?'inline-flex':'none'; };
  show('navPromoters', isCompany); show('navStores', isCompany); show('navPost', isCompany);
  show('navActive', (isCompany||isPromoter)); show('navSuper', isSuper);
});
</script>

<main class="container">
  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center;gap:10px">
      <h2 style="margin:0">Stores</h2>
      <button id="toggleCreate" class="btn">➕ Create Store</button>
    </div>

    <div id="createWrap" class="card" style="margin-top:12px; display:none">
      <div class="grid grid-3">
        <div><label>Store Name</label><input id="storeName" placeholder="Shoprite Campus Square"></div>
        <div><label>Code (optional)</label><input id="storeCode" placeholder="SHP-001"></div>
        <div><label>Region</label>
          <select id="storeRegion">
            <option>Eastern Cape</option><option>Free State</option><option>Gauteng</option><option>KwaZulu-Natal</option>
            <option>Limpopo</option><option>Mpumalanga</option><option>North West</option><option>Northern Cape</option><option>Western Cape</option>
          </select>
        </div>
        <div style="grid-column:1/-1"><label>Address (optional)</label><input id="storeAddress" placeholder="Full address"></div>
        <div><label>Latitude</label><input id="storeLat" placeholder="-26.2041" inputmode="decimal"></div>
        <div><label>Longitude</label><input id="storeLng" placeholder="28.0473" inputmode="decimal"></div>
        <div class="grid" style="grid-template-columns:1fr auto;align-items:end">
          <div class="small">Tip: use <a href="https://www.latlong.net/" target="_blank" rel="noopener">latlong.net</a> to fetch coordinates.</div>
          <button id="addStoreBtn" class="btn">Save Store</button>
        </div>
      </div>
    </div>

    <div class="table-wrap" style="margin-top:12px">
      <table class="table" id="storesTable">
        <thead><tr><th>Name</th><th>Region</th><th>Lat/Lng</th><th>Assigned</th><th>Actions</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </div>
</main>
<footer class="ftr">© 2025 FindMe • All rights reserved</footer>

<script type="module">
import { onAuth, getUserDoc, listStoresByOwner, addStore, deleteStore, listStoreAssignments } from './js/offline.js';
let ME=null, STORES=[];
onAuth(async (u)=>{ if(!u){ location.href='login.html'; return; } ME=await getUserDoc(u.id||u); if(ME.role!=='company'){ location.href='dashboard.html'; return; } await renderStores(); });
toggleCreate.addEventListener('click', ()=>{ createWrap.style.display = (createWrap.style.display==='none'||!createWrap.style.display)?'block':'none'; });
addStoreBtn.addEventListener('click', async ()=>{ const p={ ownerId:ME.id, name:storeName.value.trim(), code:storeCode.value.trim(), region:storeRegion.value, address:storeAddress.value.trim(), lat:parseFloat(storeLat.value), lng:parseFloat(storeLng.value) }; if(!p.name||!p.region||isNaN(p.lat)||isNaN(p.lng)) return alert('Please provide name, region, latitude and longitude.'); await addStore(p); storeName.value=storeCode.value=storeAddress.value=storeLat.value=storeLng.value=''; createWrap.style.display='none'; await renderStores(); });
async function renderStores(){ STORES=await listStoresByOwner(ME.id); const tb=document.querySelector('#storesTable tbody'); tb.innerHTML=''; for(const s of STORES){ const assigned=await listStoreAssignments(s.id); const tr=document.createElement('tr'); tr.innerHTML='<td>'+s.name+'<div class="small">'+(s.code||'')+'</div></td><td>'+ (s.region||'-') +'</td><td>'+ (s.lat??'-')+', '+(s.lng??'-') +'</td><td><span class="badge">'+assigned.length+' assigned</span></td><td><a class="btn" href="store_detail.html?id='+s.id+'">View</a> <button class="btn-danger" data-del="'+s.id+'">Delete</button></td>'; tb.appendChild(tr); } }
document.querySelector('#storesTable').addEventListener('click', async (e)=>{ const did=e.target.closest('button[data-del]')?.getAttribute('data-del'); if(did){ if(confirm('Delete this store? Assignments and check-ins for it will also be removed.')){ await deleteStore(ME.id, did); await renderStores(); } } });
</script>
<div id="toast" class="toast"></div>

<script>
function toast(msg, ok=true){ const el=document.getElementById('toast'); if(!el) return; el.textContent=msg; el.style.background=ok?'#111':'#b00'; el.classList.add('show'); setTimeout(()=>{ el.classList.remove('show'); }, 1800); }
</script>

<script>
// mobile nav toggle binder
(function(){ var btn=document.getElementById('navToggle'); var nav=document.getElementById('mainNav')||document.querySelector('.nav'); if(btn && nav && !btn.dataset.bnd){ btn.dataset.bnd='1'; btn.addEventListener('click', function(){ var isOpen=nav.classList.toggle('open'); btn.setAttribute('aria-expanded', isOpen?'true':'false'); }); } })();
</script>
</body></html>


