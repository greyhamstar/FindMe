<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FindMe! — Applications</title>
  <link rel="stylesheet" href="assets/style.css" />
</head>
<body>
  <div class="container">
    <div id="nav"></div>
    <div class="card">
      <h1>Applications</h1>
      <div id="list"></div>
    </div>
    <footer>FindMe! MVP • LocalStorage demo</footer>
  </div>

  <script type="module">
    import { Auth, ensureNav } from './js/auth.js';
    import { Campaigns } from './js/campaigns.js';
    import { db } from './js/storage.js';
    import { getParam, formatDate } from './js/utils.js';
    ensureNav();
    const me = Auth.requireAuth();
    if (me.role !== 'company') location.href = 'promoter_dashboard.html';

    const cId = getParam('campaignId');
    const container = document.querySelector('#list');
    const render = () => {
      const items = cId ? Campaigns.applicationsForCampaign(cId) : Campaigns.applicationsForCompany(me.id);
      if (!items.length) { container.innerHTML = '<div class="empty">No applications yet.</div>'; return; }
      container.innerHTML = items.map(a => {
        const p = db.findById('users', a.promoterId) || {name:'Unknown', region:'-'};
        const cam = Campaigns.get(a.campaignId);
        return `
          <div class="card">
            <div class="kicker">${cam?.title ?? 'Campaign'} • ${formatDate(cam?.date ?? a.createdAt)}</div>
            <h3>${p.name}</h3>
            <div class="badge">${p.region}</div>
            <p class="small">Skills: ${(p.skills||[]).join(', ') || '—'}</p>
            <div class="row" style="justify-content: space-between; align-items:center">
              <span class="small">Applied on ${formatDate(a.createdAt)}</span>
              <button class="btn secondary" disabled>Pending</button>
            </div>
          </div>
        `;
      }).join('');
    };
    render();
  </script>
</body>
</html>
