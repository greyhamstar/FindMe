<!doctype html><html lang='en'><head><meta charset='utf-8'><meta name='viewport' content='width=device-width,initial-scale=1'><title>FindMe — Super Admin</title><link rel='stylesheet' href='css/style.css'></head><body>

<script>
// Hard gate: promoters cannot access this page
(function(){
  try{
    var s = JSON.parse(localStorage.getItem('fm_session')||'{}');
    var users = JSON.parse(localStorage.getItem('fm_users')||'[]');
    var me = users.find(function(u){ return u.id===s.uid; }) || null;
    if(me && me.role==='promoter'){
      location.href = 'dashboard.html';
    }
  }catch(e){}
})();
</script>

<header class="hdr">
  <div class="brand">
    <img class="brand-logo" src="assets/logo.png" alt="FindMe logo">
    <div class="brand-text">
      <span class="brand-name">FindMe</span>
      <span class="brand-tag">Campaign Staffing</span>
    </div>
  </div>
  <div class="hdr-right">
    <nav id="mainNav" class="nav"><button id="navToggle" class="nav-toggle" aria-label="Menu" aria-expanded="false" aria-controls="mainNav">☰</button><div class="nav-items">
      <a class="chip" href="index.html">Home</a>
      <a class="chip" href="dashboard.html">Dashboard</a>
      <a class="chip" href="update_profile.html">Profile</a>
      <a class="chip" id="navPromoters" href="promoters.html">Promoters</a>
      <a class="chip" id="navStores" href="stores.html">Stores</a>
      <a class="chip" id="navPost" href="post_campaign.html">Post Campaign</a>
      <a class="chip" id="navActive" href="active_campaigns.html">Active Campaigns</a>
      <a class="chip" id="navSuper" href="super.html">Super</a>
      <a class="chip" href="signup.html">Create account</a>
      <button id="logoutBtn" class="btn-ghost">Logout</button>
    </div></nav>

<script>
// Role-based nav hide (fast, before modules)
(function(){
  try{
    var s = JSON.parse(localStorage.getItem('fm_session')||'{}');
    var users = JSON.parse(localStorage.getItem('fm_users')||'[]');
    var me = users.find(function(u){ return u.id===s.uid; }) || null;
    if(me && me.role==='promoter'){
      ['navPromoters','navStores','navPost','navSuper'].forEach(function(id){
        var el=document.getElementById(id); if(el) el.style.display='none';
      });
    }
  }catch(e){}
})();
</script>

    <button class="btn-ghost icon" id="navToggle" aria-label="Menu">☰</button>
  </div>
</header>
<script type="module">
import { onAuth, getUserDoc, signOut } from './js/offline.js';
document.getElementById('navToggle').addEventListener('click', ()=>document.querySelector('.nav').classList.toggle('open'));
const lg = document.getElementById('logoutBtn'); if(lg) lg.addEventListener('click', ()=>signOut().then(()=>location.href='login.html'));
onAuth(async (u)=>{ 
  const me = u ? await getUserDoc(u.id||u) : null;
  const isCompany = me && me.role==='company'; const isPromoter = me && me.role==='promoter'; const isSuper = me && me.role==='super';
  const show = (id, ok)=>{ const el=document.getElementById(id); if(el) el.style.display = ok?'inline-flex':'none'; };
  show('navPromoters', isCompany); show('navStores', isCompany); show('navPost', isCompany);
  show('navActive', (isCompany||isPromoter)); show('navSuper', isSuper);
});
</script>

<main class="container">
  <div class="card">
    <h2 style="margin:0">Super Admin</h2>
    <p class="small">Export promoters hired (accepted) for a given month.</p>
    <div class="grid grid-3">
      <div><label>Month (YYYY-MM)</label><input id="month" placeholder="2025-08"></div>
      <div class="grid" style="grid-template-columns:1fr auto;align-items:end"><div></div><button id="exportBtn" class="btn">Export CSV</button></div>
    </div>
  </div>
</main>
<script type="module">
import { onAuth, getUserDoc } from './js/offline.js';
onAuth(async (u)=>{ if(!u){ location.href='login.html'; return; } const me=await getUserDoc(u.id||u); if(me.role!=='super') location.href='dashboard.html'; });
function csvEscape(v){ if(v==null) return ''; const s=String(v).replace(/"/g,'""'); return '"'+s+'"'; }
function download(name, text){ const blob=new Blob([text],{type:'text/csv'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download=name; a.click(); setTimeout(()=>URL.revokeObjectURL(url),1000); }
exportBtn.addEventListener('click', ()=>{ const m=(month.value||'').trim(); if(!m.match(/^\d{4}-\d{2}$/)){ alert('Use YYYY-MM'); return; } const users=JSON.parse(localStorage.getItem('fm_users')||'[]'); const apps=JSON.parse(localStorage.getItem('fm_apps')||'[]'); const camps=JSON.parse(localStorage.getItem('fm_campaigns')||'[]'); const byCamp=Object.fromEntries(camps.map(c=>[c.id,c])); const start=new Date(m+'-01T00:00:00Z'); const end=new Date(start); end.setMonth(end.getMonth()+1); const accepted=apps.filter(a=>a.status==='accepted').filter(a=>{ const t=new Date(a.updatedAt||a.createdAt||0); return t>=start && t<end; }); const header=['Promoter ID','First Name','Surname','Email','Region','Company Owner','Campaign Title','App Status','Last Updated']; const lines=[header.map(csvEscape).join(',')]; accepted.forEach(a=>{ const p=users.find(u=>u.id===a.promoterId)||{}; const c=byCamp[a.campaignId]||{}; lines.push([p.id,p.firstName,p.surname,p.email,p.region,c.ownerId,(c.title||c.id),a.status,(a.updatedAt||a.createdAt||'')].map(csvEscape).join(',')); }); download('findme_promoters_hires_'+m+'.csv', lines.join('\n')); });
</script>
<div id="toast" class="toast"></div>

<script>
function toast(msg, ok=true){ const el=document.getElementById('toast'); if(!el) return; el.textContent=msg; el.style.background=ok?'#111':'#b00'; el.classList.add('show'); setTimeout(()=>{ el.classList.remove('show'); }, 1800); }
</script>

<script>
// mobile nav toggle binder
(function(){ var btn=document.getElementById('navToggle'); var nav=document.getElementById('mainNav')||document.querySelector('.nav'); if(btn && nav && !btn.dataset.bnd){ btn.dataset.bnd='1'; btn.addEventListener('click', function(){ var isOpen=nav.classList.toggle('open'); btn.setAttribute('aria-expanded', isOpen?'true':'false'); }); } })();
</script>

<script>
// mobile nav toggle binder v2
(function(){
  var btn = document.getElementById('navToggle');
  var nav = document.getElementById('mainNav');
  if(btn && nav && !btn.dataset.bnd){
    btn.dataset.bnd = '1';
    btn.addEventListener('click', function(){
      var isOpen = nav.classList.toggle('open');
      btn.setAttribute('aria-expanded', isOpen ? 'true' : 'false');
    });
  }
})();
</script>
</body></html>



