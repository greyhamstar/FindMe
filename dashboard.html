<!DOCTYPE html><html lang='en'><head>
<meta charset='UTF-8'/>
<meta name='viewport' content='width=device-width, initial-scale=1.0, viewport-fit=cover'/>
<title>FindMe — Dashboard</title>
<link rel='preconnect' href='https://fonts.googleapis.com'>
<link rel='preconnect' href='https://fonts.gstatic.com' crossorigin>
<link href='https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap' rel='stylesheet'>
<link rel='icon' href='assets/logo.png' type='image/png'>
<link rel='apple-touch-icon' href='assets/icon-192.png'>
<link rel='manifest' href='site.webmanifest'>
<link rel='stylesheet' href='css/style.css'/>
</head><body>
<header class="header">
  <div class="logo">
    <img class="logo-img" src="assets/logo.png" alt="FindMe logo" />
    <div>FindMe!</div>
  </div>
  <button class="hamburger" id="navToggle" aria-label="Toggle menu">☰</button>
  <nav class="nav">
    
  <span id="whoami" class="badge"></span>
  <a class="badge" href="index.html">Home</a>
  <a class="badge" href="post_campaign.html">Post</a>
  <a class="badge" href="promoters.html">Promoters</a>
  <button id="logoutBtn" class="badge secondary">Logout</button>

  </nav>
</header>
<main class="container">
  <div class="card" id="promoterCard">
    <h2>Promoter Dashboard</h2>
    <div class="flex">
      <a class="badge" href="promoter_profile.html">Update Profile</a>
    </div>
    <h3>Campaigns in your region</h3>
    <div class="table-wrap">
      <table class="table" id="campaignTable">
        <thead><tr><th>Title</th><th>Region</th><th>Budget</th><th>Apply</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>

    <h3>Invitations</h3>
    <div class="table-wrap">
      <table class="table" id="inviteTable">
        <thead><tr><th>Campaign</th><th>Company</th><th>Region</th><th>Message</th><th>Status</th><th>Actions</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <div class="card" id="companyCard">
    <h2>Company Dashboard</h2>
    <div class="flex">
      <a class="badge" href="post_campaign.html">Post a Campaign</a>
      <a class="badge" href="promoters.html">Browse Promoters</a>
    </div>
    <h3>Your Campaigns</h3>
    <div class="table-wrap">
      <table class="table" id="myCampaigns">
        <thead><tr><th>Title</th><th>Region</th><th>Budget</th><th>Applications</th><th>Invites</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </div>
</main>
<footer class='footer'>© 2025 FindMe! · Made with ♥</footer>
<script src='js/app.js'></script>
<script>
const me=getSession(); protect(me);
document.getElementById('whoami').textContent=me.role==='promoter'?`${me.firstName||''} ${me.surname||''} — ${me.region}`.trim():`${me.companyName} — ${me.region}`;
document.getElementById('logoutBtn').addEventListener('click',logout);

const promoterCard=document.getElementById('promoterCard');
const companyCard=document.getElementById('companyCard');
promoterCard.style.display=me.role==='promoter'?'block':'none';
companyCard.style.display=me.role==='company'?'block':'none';

if(me.role==='promoter'){
  const tbody=document.querySelector('#campaignTable tbody');
  tbody.innerHTML='';
  listCampaigns().filter(c=>c.region===me.region).forEach(c=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`
      <td data-label="Title">${c.title}</td>
      <td data-label="Region">${c.region}</td>
      <td data-label="Budget">R ${c.budget}</td>
      <td data-label="Apply"><button data-id="${c.id}">Apply</button></td>`;
    tbody.appendChild(tr);
  });
  tbody.addEventListener('click',e=>{
    if(e.target.tagName==='BUTTON'){
      const id=e.target.getAttribute('data-id');
      applyToCampaign(id,me.id);
      alert('Application submitted!');
      refreshCompanyTable();
    }
  });

  const itbody=document.querySelector('#inviteTable tbody');
  function renderInvites(){
    itbody.innerHTML='';
    listInvitesForPromoter(me.id).forEach(inv=>{
      const camp=getCampaign(inv.campaignId);
      const comp=getUser(inv.companyId);
      const tr=document.createElement('tr');
      tr.innerHTML=`
        <td data-label="Campaign">${camp?.title||'-'}</td>
        <td data-label="Company">${comp?.companyName||'-'}</td>
        <td data-label="Region">${camp?.region||'-'}</td>
        <td data-label="Message">${inv.message||'-'}</td>
        <td data-label="Status">${inv.status}</td>
        <td data-label="Actions">${
          inv.status==='sent'
            ? '<button data-act="accept" data-id="'+inv.id+'">Accept</button> <button class="secondary" data-act="decline" data-id="'+inv.id+'">Decline</button>'
            : '-'
        }</td>`;
      itbody.appendChild(tr);
    });
  }
  itbody.addEventListener('click',e=>{
    const act=e.target.getAttribute('data-act');
    if(!act)return;
    const id=e.target.getAttribute('data-id');
    if(act==='accept'){ acceptInvite(id); const inv=getInvite(id); applyToCampaign(inv.campaignId,me.id); }
    else if(act==='decline'){ declineInvite(id); }
    renderInvites();
    alert('Invitation '+act+'ed.');
  });
  renderInvites();
}

function refreshCompanyTable(){
  if(me.role!=='company')return;
  const tbody2=document.querySelector('#myCampaigns tbody');
  tbody2.innerHTML='';
  listCampaigns().filter(c=>c.ownerId===me.id).forEach(c=>{
    const apps=listApplications().filter(a=>a.campaignId===c.id);
    const count=apps.length;
    const invites=listInvitesForCampaign(c.id);
    const invCount=invites.length;
    const view=count?`<details><summary>${count} application(s)</summary>${
      apps.map(a=>{ const p=getUser(a.promoterId);
        return `<div class='card'><div><strong>${p.firstName} ${p.surname}</strong> (${p.region})</div>
                <div>Email: ${p.email}</div>
                <div>SA ID: ${p.idNumber||'-'}</div>
                <div>CV: ${p.cvName||'-'}</div></div>`;
      }).join('')
    }</details>`:'0';
    const tr2=document.createElement('tr');
    tr2.innerHTML=`
      <td data-label="Title">${c.title}</td>
      <td data-label="Region">${c.region}</td>
      <td data-label="Budget">R ${c.budget}</td>
      <td data-label="Applications">${view}</td>
      <td data-label="Invites">${invCount}</td>`;
    tbody2.appendChild(tr2);
  });
}
refreshCompanyTable();
</script>
</body></html>
