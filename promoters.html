<!doctype html><html lang="en"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>FindMe — Browse Promoters (Offline)</title>
<link rel="icon" href="assets/logo.png">
<link rel="apple-touch-icon" href="assets/icon-192.png">
<link rel="manifest" href="site.webmanifest">
<link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=Plus+Jakarta+Sans:wght@500;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="css/style.css">
</head><body>
<header class="hdr">
  <div class="brand">
    <img class="brand-logo" src="assets/logo.png" alt="FindMe logo">
    <div class="brand-text">
      <span class="brand-name">FindMe</span>
      <span class="brand-tag">Campaign Staffing</span>
    </div>
  </div>
  <div class="hdr-right">
    <nav class="nav">
  <a class="chip" href="dashboard.html">Dashboard</a>
  <a class="chip" id="navSuper" href="super.html">Super</a>
  <button id="logoutBtn" class="btn-ghost">Logout</button>
</nav>
    <button class="btn-ghost icon" id="navToggle" aria-label="Menu">☰</button>
  </div>
</header>
<main class="container">
  <div class="card">
    <h2 style="margin-top:0">Browse Promoters</h2>
    <p class="small">Filter by name/email and province. Click <em>View</em> for full profile or <em>Invite</em> to a campaign.</p>
    <div class="grid grid-3">
      <div><label>Search</label><input id="q" placeholder="Type a name or email"/></div>
      <div><label>Region (Province)</label><select id="region"><option value="">All Regions</option><option>Eastern Cape</option><option>Free State</option><option>Gauteng</option><option>KwaZulu-Natal</option><option>Limpopo</option><option>Mpumalanga</option><option>North West</option><option>Northern Cape</option><option>Western Cape</option></select></div>
      <div class="grid" style="grid-template-columns:1fr auto; align-items:end"><button id="refreshBtn" class="btn">Apply Filters</button><button id="clearBtn" class="btn-ghost">Clear</button></div>
    </div>
    <div class="table-wrap" style="margin-top:10px">
      <table class="table" id="promoterTable">
        <thead><tr><th></th><th>Name</th><th>Region</th><th>Email</th><th>SA ID</th><th>CV</th><th>Actions</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </div>
</main>
<div id="detailOverlay" class="modal-overlay"><div class="modal">
  <div class="modal-header"><h3 id="detailTitle" style="margin:0">Promoter Details</h3><button class="close-x" data-close="detailOverlay">Close</button></div>
  <div id="detailBody" style="margin-top:10px"></div>
  <div class="grid" style="grid-template-columns:1fr auto; margin-top:12px"><span></span><button id="detailInviteBtn" class="btn">Invite to Campaign</button></div>
</div></div>
<div id="inviteOverlay" class="modal-overlay"><div class="modal">
  <div class="modal-header"><h3 id="inviteTitle" style="margin:0">Invite to Campaign</h3><button class="close-x" data-close="inviteOverlay">Close</button></div>
  <div id="inviteBody" style="margin-top:10px"><div class="grid grid-2"><div><label>Campaign</label><select id="inviteCampaign"></select><p class="small" id="inviteHint"></p></div><div><label>Message (optional)</label><textarea id="inviteMsg" rows="4"></textarea></div></div></div>
  <div class="grid" style="grid-template-columns:1fr auto; margin-top:12px"><span></span><button id="sendInviteBtn" class="btn">Send Invite</button></div>
</div></div>
<footer class='ftr'>© 2025 FindMe • All rights reserved</footer>
<script type="module">
import { onAuth, signOut, listPromoters, getUserDoc, listCampaignsByOwner, sendInvite } from './js/offline.js';
document.getElementById('logoutBtn').addEventListener('click', ()=>signOut().then(()=>location.href='login.html'));
const q=document.getElementById('q'), regionSel=document.getElementById('region'), tbody=document.querySelector('#promoterTable tbody');
const count=document.createElement('div'); count.className='small'; count.style.marginTop='8px'; document.querySelector('.card').appendChild(count);
function openOverlay(id){ document.getElementById(id).style.display='flex'; } function closeOverlay(id){ document.getElementById(id).style.display='none'; }
document.body.addEventListener('click',(e)=>{ const id=e.target.getAttribute('data-close'); if(id) closeOverlay(id); });
let me=null, selected=null, myCampaigns=[];
onAuth(async (u)=>{
  if(!u){ location.href='login.html'; return; }
  me = await getUserDoc(u.id);
  if(me.role!=='company'){ location.href='dashboard.html'; return; }
  myCampaigns = await listCampaignsByOwner(u.id);
  render();
});
async function render(){
  const all=await listPromoters();
  const query=(q.value||'').toLowerCase(); const region=regionSel.value;
  const items=all.filter(p=>{ const mt=!query||(`${p.firstName||''} ${p.surname||''} ${p.email||''}`.toLowerCase().includes(query)); const mr=!region||p.region===region; return mt&&mr; });
  tbody.innerHTML='';
  items.forEach(p=>{
    const img=p.photoFormal?`<img class="avatar-sm" src="${p.photoFormal}" alt="avatar">`:`<img class="avatar-sm" src="assets/icon-192.png" alt="avatar">`;
    const tr=document.createElement('tr');
    tr.innerHTML=`<td data-label="">${img}</td><td data-label="Name">${p.firstName||''} ${p.surname||''}<div class="small">${p.ethnicity||''} • ${p.gender||''}</div></td><td data-label="Region">${p.region||'-'}</td><td data-label="Email">${p.email||'-'}</td><td data-label="SA ID">${p.idNumber||'-'}</td><td data-label="CV">${p.cvName||'-'}</td><td data-label="Actions"><button class="btn" data-a="view" data-id="${p.id}">View</button> <button class="btn-ghost" data-a="invite" data-id="${p.id}">Invite</button></td>`;
    tbody.appendChild(tr);
  });
  count.textContent=items.length+' promoter(s)';
}
tbody.addEventListener('click', async (e)=>{
  const a=e.target.getAttribute('data-a'); if(!a) return; const id=e.target.getAttribute('data-id');
  selected={ id, name:'' };
  const p = await getUserDoc(id);
  selected.name = ((p?.firstName||'')+' '+(p?.surname||'')).trim();
  if(a==='view'){
    detailTitle.textContent=selected.name||'Promoter Details';
    const img=p?.photoFormal?`<img class="avatar" src="${p.photoFormal}" alt="avatar" style="width:120px;height:120px">`:`<img class="avatar" src="assets/icon-192.png" alt="avatar" style="width:120px;height:120px">`;
    detailBody.innerHTML=`
      <div class="grid grid-2">
        <div>${img}</div>
        <div>
          <div><strong>Name:</strong> ${p?.firstName||''} ${p?.surname||''}</div>
          <div><strong>Region:</strong> ${p?.region||'-'}</div>
          <div><strong>Email:</strong> ${p?.email||'-'}</div>
          <div><strong>SA ID:</strong> ${p?.idNumber||'-'}</div>
          <div><strong>Ethnicity:</strong> ${p?.ethnicity||'-'}</div>
          <div><strong>Gender:</strong> ${p?.gender||'-'}</div>
          <div><strong>CV:</strong> ${p?.cvName||'-'}</div>
        </div>
      </div>`;
    openOverlay('detailOverlay');
  } else if(a==='invite'){ showInvite(); }
});
detailInviteBtn.addEventListener('click',()=>{ if(selected){ closeOverlay('detailOverlay'); showInvite(); } });
function showInvite(){
  inviteTitle.textContent='Invite '+(selected?.name||'');
  const sel=inviteCampaign; sel.innerHTML='';
  if(!myCampaigns.length){ sel.innerHTML='<option value="">No campaigns — create one first.</option>'; }
  else { myCampaigns.forEach(c=>{ const o=document.createElement('option'); o.value=c.id; o.textContent=`${c.title} — ${c.region} (R ${c.budget})`; sel.appendChild(o); }); }
  inviteHint.textContent=myCampaigns.length?'Select a campaign to invite.':'No campaigns found.'; inviteMsg.value='';
  openOverlay('inviteOverlay');
}
sendInviteBtn.addEventListener('click', async ()=>{
  const cid=inviteCampaign.value, msg=inviteMsg.value.trim();
  if(!cid) return alert('Select a campaign');
  await sendInvite({ companyId: me.id, promoterId: selected.id, campaignId: cid, message: msg });
  closeOverlay('inviteOverlay'); alert('Invite sent!');
});
refreshBtn.addEventListener('click',render); clearBtn.addEventListener('click',()=>{ q.value=''; region.value=''; render(); });
</script>
<script>document.addEventListener('click',e=>{if(e.target?.id==='navToggle'){document.querySelector('.nav')?.classList.toggle('open')}if(e.target?.closest('.nav')&&e.target.tagName==='A'){document.querySelector('.nav')?.classList.remove('open')}});</script>
<script type="module">
import { onAuth, getUserDoc } from './js/offline.js';
onAuth(async (u)=>{
  const link=document.getElementById('navSuper'); if(!link) return;
  const you = u ? await getUserDoc(u.id||u) : null;
  link.style.display = (you && you.role==='super') ? 'inline-flex' : 'none';
});
</script>
</body></html>