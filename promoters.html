<!doctype html><html lang='en'><head><meta charset='utf-8'><meta name='viewport' content='width=device-width,initial-scale=1'><title>FindMe — Promoters</title><link rel='stylesheet' href='css/style.css'></head><body>

<script>
// Hard gate: promoters cannot access this page
(function(){
  try{
    var s = JSON.parse(localStorage.getItem('fm_session')||'{}');
    var users = JSON.parse(localStorage.getItem('fm_users')||'[]');
    var me = users.find(function(u){ return u.id===s.uid; }) || null;
    if(me && me.role==='promoter'){
      location.href = 'dashboard.html';
    }
  }catch(e){}
})();
</script>

<header class="hdr">
  <div class="brand">
    <img class="brand-logo" src="assets/logo.png" alt="FindMe logo">
    <div class="brand-text">
      <span class="brand-name">FindMe</span>
      <span class="brand-tag">Campaign Staffing</span>
    </div>
  </div>
  <div class="hdr-right">
    <nav id="mainNav" class="nav"><button id="navToggle" class="nav-toggle" aria-label="Menu" aria-expanded="false" aria-controls="mainNav">☰</button><div class="nav-items">
      <a class="chip" href="index.html">Home</a>
      <a class="chip" href="dashboard.html">Dashboard</a>
      <a class="chip" href="update_profile.html">Profile</a>
      <a class="chip" id="navPromoters" href="promoters.html">Promoters</a>
      <a class="chip" id="navStores" href="stores.html">Stores</a>
      <a class="chip" id="navPost" href="post_campaign.html">Post Campaign</a>
      <a class="chip" id="navActive" href="active_campaigns.html">Active Campaigns</a>
      <a class="chip" id="navSuper" href="super.html">Super</a>
      <a class="chip" href="signup.html">Create account</a>
      <button id="logoutBtn" class="btn-ghost">Logout</button>
    </div></nav>

<script>
// Role-based nav hide (fast, before modules)
(function(){
  try{
    var s = JSON.parse(localStorage.getItem('fm_session')||'{}');
    var users = JSON.parse(localStorage.getItem('fm_users')||'[]');
    var me = users.find(function(u){ return u.id===s.uid; }) || null;
    if(me && me.role==='promoter'){
      ['navPromoters','navStores','navPost','navSuper'].forEach(function(id){
        var el=document.getElementById(id); if(el) el.style.display='none';
      });
    }
  }catch(e){}
})();
</script>

    <button class="btn-ghost icon" id="navToggle" aria-label="Menu">☰</button>
  </div>
</header>
<script type="module">
import { onAuth, getUserDoc, signOut } from './js/offline.js';
document.getElementById('navToggle').addEventListener('click', ()=>document.querySelector('.nav').classList.toggle('open'));
const lg = document.getElementById('logoutBtn'); if(lg) lg.addEventListener('click', ()=>signOut().then(()=>location.href='login.html'));
onAuth(async (u)=>{ 
  const me = u ? await getUserDoc(u.id||u) : null;
  const isCompany = me && me.role==='company'; const isPromoter = me && me.role==='promoter'; const isSuper = me && me.role==='super';
  const show = (id, ok)=>{ const el=document.getElementById(id); if(el) el.style.display = ok?'inline-flex':'none'; };
  show('navPromoters', isCompany); show('navStores', isCompany); show('navPost', isCompany);
  show('navActive', (isCompany||isPromoter)); show('navSuper', isSuper);
});
</script>

<main class="container">
  <div class="card">
    <h2 style="margin:0">Promoters</h2>
    <div class="grid grid-3" style="margin-top:8px">
      <div><label>Search</label><input id="q" placeholder="Name or email"></div>
      <div><label>Region</label>
        <select id="reg">
          <option value="">All</option><option>Eastern Cape</option><option>Free State</option><option>Gauteng</option><option>KwaZulu-Natal</option>
          <option>Limpopo</option><option>Mpumalanga</option><option>North West</option><option>Northern Cape</option><option>Western Cape</option>
        </select>
      </div>
      <div class="grid" style="grid-template-columns:1fr auto;align-items:end"><div></div><button id="searchBtn" class="btn">Search</button></div>
    </div>
    <div class="table-wrap" style="margin-top:10px">
      <table class="table" id="tbl"><thead><tr><th>Name</th><th>Region</th><th>Ethnicity</th><th>Gender</th><th>View</th><th>Invite</th></tr></thead><tbody></tbody></table>
    </div>
  </div>
</main>

<div id="viewOverlay" class="modal-overlay"><div class="modal">
  <div class="modal-header"><h3 id="vTitle" style="margin:0">Promoter profile</h3><button class="close-x" data-close="viewOverlay">Close</button></div>
  <div class="grid grid-2"><div id="vLeft"></div><div id="vRight"></div></div>
</div></div>

<div id="inviteOverlay" class="modal-overlay"><div class="modal">
  <div class="modal-header"><h3 style="margin:0">Invite to campaign</h3><button class="close-x" data-close="inviteOverlay">Close</button></div>
  <div class="grid">
    <div><label>Campaign ID (paste one of yours)</label><input id="invCampId" placeholder="id_..."></div>
    <div><label>Message</label><textarea id="invMsg" placeholder="Short note"></textarea></div>
    <div class="grid" style="grid-template-columns:1fr auto;align-items:end"><div id="invStatus" class="small"></div><button id="invSend" class="btn">Send invite</button></div>
  </div>
</div></div>

<script type="module">
import { onAuth, getUserDoc, listPromoters, sendInvite } from './js/offline.js';
let ME=null, PROM=[];
onAuth(async (u)=>{ if(!u){ location.href='login.html'; return; } ME=await getUserDoc(u.id||u); if(ME.role!=='company'){ location.href='dashboard.html'; return; } await search(); });
document.getElementById('searchBtn').addEventListener('click', search);
async function search(){ PROM = await listPromoters(); const q=(qEl.value||'').toLowerCase(); const reg=regEl.value; const tb=document.querySelector('#tbl tbody'); tb.innerHTML=''; PROM.filter(p=>(!reg||p.region===reg)&&(!q||((p.firstName||'')+' '+(p.surname||'')+' '+(p.email||'')).toLowerCase().includes(q))).forEach(p=>{ const tr=document.createElement('tr'); tr.innerHTML='<td>'+p.firstName+' '+p.surname+'</td><td>'+p.region+'</td><td>'+(p.ethnicity||'-')+'</td><td>'+(p.gender||'-')+'</td><td><button class="btn-ghost" data-view="'+p.id+'">View</button></td><td><button class="btn" data-invite="'+p.id+'">Invite</button></td>'; tb.appendChild(tr); }); }
const qEl=document.getElementById('q'), regEl=document.getElementById('reg');
document.body.addEventListener('click',(e)=>{ const id=e.target.getAttribute('data-close'); if(id) document.getElementById(id).style.display='none'; });
document.querySelector('#tbl').addEventListener('click',(e)=>{ const vid=e.target.getAttribute('data-view'); const iid=e.target.getAttribute('data-invite'); if(vid) openView(vid); if(iid) openInvite(iid); });
function openView(uid){ const p=PROM.find(x=>x.id===uid); if(!p) return; vTitle.textContent=(p.firstName||'')+' '+(p.surname||''); const photo=p.photoFormal?'<img src="'+p.photoFormal+'" style="width:160px;height:160px;object-fit:cover;border-radius:12px;border:1px solid var(--border)">':'<div class="badge">No photo</div>'; vLeft.innerHTML=photo+'<div class="small" style="margin-top:8px">'+(p.email||'')+'</div>'; const priv=JSON.parse(localStorage.getItem('fm_private_'+p.id)||'{}'); const cv=JSON.parse(localStorage.getItem('fm_cv_'+p.id)||'null'); const cvLink = cv?('<a class="chip" href="'+cv.dataUrl+'" download="'+(cv.name || 'cv')+'">Download CV</a>'):'<span class="small">No CV uploaded</span>'; vRight.innerHTML='<div><strong>Region:</strong> '+(p.region||'-')+'</div>'+'<div><strong>Ethnicity:</strong> '+(p.ethnicity||'-')+'</div>'+'<div><strong>Gender:</strong> '+(p.gender||'-')+'</div>'+'<div><strong>ID:</strong> '+(p.idNumber||'-')+'</div>'+'<div><strong>Bank:</strong> '+(priv.bankName||'-')+'</div>'+'<div><strong>Account #:</strong> '+(priv.accountNumber||'-')+'</div>'+'<div><strong>Account Type:</strong> '+(priv.accountType||'-')+'</div>'+'<div><strong>CV:</strong> '+cvLink+'</div>'; document.getElementById('viewOverlay').style.display='flex'; }
let INV_TO=null; function openInvite(uid){ INV_TO=uid; invCampId.value=''; invMsg.value=''; invStatus.textContent=''; document.getElementById('inviteOverlay').style.display='flex'; }
document.getElementById('invSend').addEventListener('click', async ()=>{ const cid=invCampId.value.trim(); const msg=invMsg.value.trim(); if(!cid){ invStatus.textContent='Paste a campaign id first.'; return; } await sendInvite({ companyId: ME.id, promoterId: INV_TO, campaignId: cid, message: msg }); invStatus.textContent='Sent ✓'; setTimeout(()=>document.getElementById('inviteOverlay').style.display='none', 800); });
</script>
<div id="toast" class="toast"></div>

<script>
function toast(msg, ok=true){ const el=document.getElementById('toast'); if(!el) return; el.textContent=msg; el.style.background=ok?'#111':'#b00'; el.classList.add('show'); setTimeout(()=>{ el.classList.remove('show'); }, 1800); }
</script>

<script>
// mobile nav toggle binder
(function(){ var btn=document.getElementById('navToggle'); var nav=document.getElementById('mainNav')||document.querySelector('.nav'); if(btn && nav && !btn.dataset.bnd){ btn.dataset.bnd='1'; btn.addEventListener('click', function(){ var isOpen=nav.classList.toggle('open'); btn.setAttribute('aria-expanded', isOpen?'true':'false'); }); } })();
</script>

<script>
// mobile nav toggle binder v2
(function(){
  var btn = document.getElementById('navToggle');
  var nav = document.getElementById('mainNav');
  if(btn && nav && !btn.dataset.bnd){
    btn.dataset.bnd = '1';
    btn.addEventListener('click', function(){
      var isOpen = nav.classList.toggle('open');
      btn.setAttribute('aria-expanded', isOpen ? 'true' : 'false');
    });
  }
})();
</script>

<script>
// mobile nav toggle binder v3
(function(){
  var nav = document.getElementById('mainNav');
  var btn = document.getElementById('navToggle');
  if(!nav || !btn) return;
  if(!btn.dataset.bnd){
    btn.dataset.bnd = '1';
    btn.addEventListener('click', function(){
      var isOpen = nav.classList.toggle('open');
      btn.setAttribute('aria-expanded', isOpen ? 'true' : 'false');
    });
    var items = nav.querySelector('.nav-items');
    if(items){
      items.addEventListener('click', function(e){
        var target = e.target;
        if(target.tagName === 'A' || target.closest('a')){
          nav.classList.remove('open');
          btn.setAttribute('aria-expanded', 'false');
        }
      });
    }
    if (window.matchMedia && window.matchMedia('(max-width: 900px)').matches){
      nav.classList.remove('open');
      btn.setAttribute('aria-expanded', 'false');
    }
  }
})();
</script>
</body></html>




